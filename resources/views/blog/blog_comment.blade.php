<!DOCTYPE html>
<html lang="en" >
<head>
  <link rel="SHORTCUT ICON" href="{{asset('images/logo/vedu.png')}}"/>
  <title>Blog comment |Vchip Technology</title>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

  <meta name="description" content="Vchip Technology is working on Digital Education platform with name V-edu, V-edu provide great education platform equally in villages and remote areas along with urban area. In other word you can learn with fun from anywhere in the world. We always believes that better society is a best place to live and educated society is best society. We are currently focusing on formation of Digital Villages and bridging between well establish Industry/start-ups and educational organizations." />
  <meta name="author" content=" Vchip Technology" />
  <meta name="keywords" content="Vchip-edu, vchipedu, Education sector, Online Courses, Digital Education, eLearning, Online learning, Online test series, Webinars, Online live courses, Live discussion,  vchip, Technology, vchip Technology, vchip Technology private ltd, vchip design and training, vchip design pvt ltd, vchip design and training pvt ltd, vishesh agrawal, web development, IoT, Internet of things, M2M, Mobile app development, Android app development, cloud formation, Internet of Everything, health sector, agriculture sector, food sector, Pune, Amravati." />

  <!-- Schema.org markup for Google+ -->
  <meta itemprop="name" content="V-edu - Digital Education, Online Courses & eLearning |Vchip Technology" />
  <meta itemprop="description" content="Vchip Technology is working on Digital Education platform with name V-edu, V-edu provide great education platform equally in villages and remote areas along with urban area. In other word you can learn with fun from anywhere in the world. We always believes that better society is a best place to live and educated society is best society. We are currently focusing on formation of Digital Villages and bridging between well establish Industry/start-ups and educational organizations." />
  <meta itemprop="image" content="img/V-edu_social_share.jpg" />

  <!-- Twitter card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="V-edu - Digital Education, Online Courses & eLearning |Vchip Technology" />
  <meta name="twitter:site" content="@V-edu" />
  <meta name="twitter:creator" content="@V-edu"/>
  <meta name="twitter:image" content="img/V-edu_social_share.jpg" />
  <meta name="twitter:description" content="Vchip Technology is working on Digital Education platform with name V-edu, V-edu provide great education platform equally in villages and remote areas along with urban area. In other word you can learn with fun from anywhere in the world. We always believes that better society is a best place to live and educated society is best society. We are currently focusing on formation of Digital Villages and bridging between well establish Industry/start-ups and educational organizations." />

  <!-- Open graph  -->
  <meta property="og:type"   content="website" />
  <meta property="og:url"    content="http://vchipedu.com/" />
  <meta property="og:site_name" content="vchipedu.com" />
  <meta property="og:title" content="V-edu - Digital Education, Online Courses & eLearning |Vchip Technology" />
  <meta property="og:image"  content="img/V-edu_social_share.jpg" />
  <meta name="og:description" content="Vchip Technology is working on Digital Education platform with name V-edu, V-edu provide great education platform equally in villages and remote areas along with urban area. In other word you can learn with fun from anywhere in the world. We always believes that better society is a best place to live and educated society is best society. We are currently focusing on formation of Digital Villages and bridging between well establish Industry/start-ups and educational organizations."/>

  <link href="{{asset('css/bootstrap.min.css?ver=1.0')}}" rel="stylesheet">
  <link href="{{asset('css/font-awesome/css/font-awesome.min.css?ver=1.0')}}" rel="stylesheet"/>
  <link href="{{asset('css/v_main.css?ver=1.0')}}" rel="stylesheet"/>
  <link href="{{asset('css/solution.css?ver=1.0') }}" rel="stylesheet"/>
  <link href="{{asset('css/comment.css?ver=1.0') }}" rel="stylesheet"/>
  <link href="{{asset('css/jquery-confirm.min.css?ver=1.0')}}" rel="stylesheet"/>

  <script src="{{asset('js/jquery.min.js?ver=1.0')}}"></script>
  <script src="{{asset('templateEditor/ckeditor/ckeditor.js')}}"></script>
  <script src="{{asset('js/jquery-confirm.min.js?ver=1.0')}}"></script>

  <style type="text/css">

/*
 * Footer
 */

.blog-footer {
  background-color:#009ACD;
  padding: 2.5rem 0;
  color: #fff;
  text-align: center;
  border-top: .05rem solid #e5e5e5;
}
 .blog-footer a{
  color: blue;
}
.blog-footer p:last-child {
  margin-bottom: 0;

}

.navbar{
    background-color:#009ACD;
    padding: 10px;
    font-color: #fff;
}
.navbar .navbar-collapse ul li>a{
color: #fff;

}
.navbar .collapse .navbar-form .form-group>input{
width: 400px;
}
.navbar .collapse .navbar-form .form-group>input:hover{
    border-color: blue;
}
.navbar-header button
{background: hotpink;}
.navbar-header span{
  background: white;
}
 @media  (min-width: 350px) {
          .hidden-lg { display: none; }
        }
      @media  (max-width: 349px) {
          .hidden-sm { display: none; }
        }
.fa-comment-o, .first-like i, .your-cmt{
  font-weight: bold;
  font-size: 18px;
  color: #555;
}
.first-like i{
  margin-right: 5px;
}
hr{
  margin-top: 5px;
  margin-bottom: 2px;
  border-bottom: 1px solid ;
}
.comment-meta{
  margin-left: 10px;
  margin-top: 20px;
  margin-bottom: 20px;
}
.ckeditor_list ul{
  list-style: none !important;
  }
.ckeditor_list ul li:before{
  content: "\f192" !important; /* FontAwesome Unicode */
  font-family: FontAwesome !important;
  display: inline-block;
  font-size: 20px;
  color: #339999;
  margin-left: -20px; /* same as padding-left set on li */
  margin-right: 5px;
  width: 20px; /* same as padding-left set on li */
}
#loginUserModel .modal-dialog{
  border-top:10px solid #01bafd;
}
#loginUserModel .close{color: #fff;}
#loginUserModel .modal, .modal-content{border-radius:  0px;
  background-color: rgba(0, 0, 0, 0.5);}
#loginUserModel    div.modal-data{
    background-color: rgba(0, 0, 0, 0.5);
        padding: 30px;
  }
#loginUserModel   div.modal-data .form-control {
background: transparent;
color: #fff;
font-size: 16px !important;
width: 100%;
border: 2px solid rgba(255, 255, 255, 0.2) !important;
-webkit-transition: 0.5s;
-o-transition: 0.5s;
transition: 0.5s;
border-radius: 0px!important
}
#loginUserModel  div.modal-data .form-group input:focus{border: 2px solid #fff !important;
}
#loginErrorMsg{
  color: red;
}
</style>
<script type="text/javascript">
    $.ajaxSetup({
        headers: {
            'X-CSRF-TOKEN': '<?= csrf_token() ?>'
        }
    });
</script>
</head>
<body>
<nav class="navbar navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <div class="collapse navbar-collapse" id="myNavbar">
      <ul class="nav navbar-nav ">
        <li><a href="{{url('/')}}">Home <span class="sr-only">(current)</span></a></li>
        <li><a href="{{url('blog')}}">Blog <span class="sr-only">(current)</span></a></li>
      </ul>
    </div>
  </div>
</nav>
<input type="hidden" name="user_id" id="user_id"
  @if(is_object($currentUser))
    value="{{$currentUser->id}}"
  @endif
>
<section id="" class="v_container v_bg_grey mrgn_50_top">
  <div class="container ">
    <div class="row">
      <div class="col-md-9 ckeditor_list">
         <h2 class="v_h2_title">The Vchip Blog</h2>
         <h3 class="v_h3_title ">{{$blog->title}}</h3>
         <p>
            {{ date('F d, Y', strtotime($blog->created_at))}} by <a>{{$blog->author}}</a>
         </p>
         <p>{!! $blog->content !!}</p>
      </div>
      <div class="col-md-3">
        <div class="vchip-right-sidebar mrgn_30_top_btm">
          <h3 class="v_h3_title text-center">Recent Blog</h3>
          <ul class="vchip_list">
            @if(count($blogs) > 0)
              @foreach($blogs as $singleBlog)
                <li title="{{ $singleBlog->title }}"><a href="{{url('blogComment')}}/{{$singleBlog->id}}">{{ $singleBlog->title }}</a></li>
              @endforeach
            @endif
          </ul>
        </div>
        <div class="vchip-right-sidebar mrgn_30_top_btm">
          <h3 class="v_h3_title text-center">Tag </h3>
            @if(count($blogTags) > 0)
              @foreach($blogTags as $index => $blogTag)
                @if( (count($blogTags)-1) == $index)
                  <a href="{{url('tagBlogs')}}/{{$blogTag->id}}">{{$blogTag->name}}</a>
                @else
                  <a href="{{url('tagBlogs')}}/{{$blogTag->id}}">{{$blogTag->name}}</a>,
                @endif
              @endforeach
            @endif
        </div>
      </div>
    </div>
  </div>
</section>
<section class="">
    <div class="container">
      <div class="with-nav-tabs">
        <div class="">
          <div class="comment-meta">
            <span id="like_{{$blog->id}}"  class="first-like">
              @if( isset($likesCount[$blog->id]) && is_object($currentUser) && isset($likesCount[$blog->id]['user_id'][$currentUser->id]))
                   <i id="blog_like_{{$blog->id}}" data-blog_id="{{$blog->id}}" data-dislike='1' class="fa fa-thumbs-up" aria-hidden="true" data-placement="bottom" title="remove like"> Like </i>
                   <span id="like1-bs3">{{count($likesCount[$blog->id]['like_id'])}}</span>
              @else
                   <i id="blog_like_{{$blog->id}}" data-blog_id="{{$blog->id}}" data-dislike='0' class="fa fa-thumbs-o-up" aria-hidden="true" data-placement="bottom" title="add like"> Like </i>
                   <span id="like1-bs3">@if( isset($likesCount[$blog->id])) {{count($likesCount[$blog->id]['like_id'])}} @endif</span>
              @endif
            </span>
            <span class="mrgn_5_left">
              <i class="fa fa-comment-o" aria-hidden="true"></i>
              @if(is_object($currentUser))
                <a class="your-cmt" role="button" data-toggle="collapse" href="#replyToBlog{{$blog->id}}" aria-expanded="false" aria-controls="collapseExample">Comment</a>
              @else
                <a class="your-cmt" role="button" data-toggle="modal" data-placement="bottom" href="#loginUserModel">Comment</a>
              @endif
            </span>
            <hr />
            <div class="collapse replyComment" id="replyToBlog{{$blog->id}}">
                <div class="form-group">
                  <textarea name="comment" id="comment" placeholder="Comment here.." class="form-control"></textarea>
                  <script type="text/javascript">
                    CKEDITOR.replace( 'comment');
                    CKEDITOR.config.width="100%";
                    CKEDITOR.config.height="auto";
                    CKEDITOR.on('dialogDefinition', function (ev) {
                        var dialogName = ev.data.name,
                            dialogDefinition = ev.data.definition;
                        if (dialogName == 'image') {
                            var onOk = dialogDefinition.onOk;
                            dialogDefinition.onOk = function (e) {
                                var width = this.getContentElement('info', 'txtWidth');
                                width.setValue('100%');
                                var height = this.getContentElement('info', 'txtHeight');
                                height.setValue('400');
                                onOk && onOk.apply(this, e);
                            };
                        }
                    });
                  </script>
                </div>
                <input type="hidden" name="blog_id" id="blog_id" value="{{$blog->id}}">
                <button type="button" class="btn btn-default" onclick="confirmSubmit(this);" id="formReplyToBlog{{$blog->id}}">Send</button>
                <button type="button" class="btn btn-default" data-id="replyToBlog{{$blog->id}}" onclick="cancleReply(this);">Cancle</button>
            </div>
          </div>
        </div>
        <div class="panel-body">
          <div class="tab-content">
            <div class="tab-pane fade in active" id="questions">
              <div class="post-comments">
                <div class="row" id="showAllComments">
                  @if(count($comments) > 0)
                    @foreach($comments as $comment)
                    <div class="box-body chat" id="chat-box">
                      <div class="item" id="showComment_{{$comment->id}}">
                        @if(!empty($comment->getUser($comment->user_id)->photo) && is_file($comment->getUser($comment->user_id)->photo) || (!empty($comment->getUser($comment->user_id)->photo) && false == preg_match('/userStorage/',$comment->getUser($comment->user_id)->photo)))
                          <img src="{{ asset($comment->getUser($comment->user_id)->photo)}} " class="img-circle" alt="User Image">
                        @else
                          <img src="{{ url('images/user1.png')}}" class="img-circle" alt="User Image">
                        @endif
                        <div class="message">
                          @if(is_object($currentUser) && ($currentUser->id == $comment->user_id))
                          <div class="dropdown pull-right">
                            <button class="btn dropdown-toggle btn-box-tool "  id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                              <i class="fa fa-ellipsis-v" aria-hidden="true"></i>
                            </button>
                            <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                              @if($currentUser->id == $comment->user_id)
                                <li><a id="{{$comment->id}}" data-blog_id="{{$blog->id}}" onclick="confirmCommentDelete(this);">Delete</a></li>
                              @endif
                              @if($currentUser->id == $comment->user_id)
                                <li><a id="{{$comment->id}}" onclick="editComment(this);">Edit</a></li>
                              @endif
                            </ul>
                          </div>
                          @endif
                            <a class="SubCommentName">{{ $comment->getUser($comment->user_id)->name }}</a>
                            <div class="more" id="editCommentHide_{{$comment->id}}">{!! $comment->body !!}</div>
                              <div class="form-group hide" id="editCommentShow_{{$comment->id}}" >
                                <textarea class="form-control" name="comment" id="comment_{{$comment->id}}" rows="3">{!! $comment->body !!}</textarea>
                                    <script type="text/javascript">
                                      CKEDITOR.replace( 'comment_{{$comment->id}}');
                                      CKEDITOR.config.width="100%";
                                      CKEDITOR.config.height="auto";
                                      CKEDITOR.on('dialogDefinition', function (ev) {
                                          var dialogName = ev.data.name,
                                              dialogDefinition = ev.data.definition;
                                          if (dialogName == 'image') {
                                              var onOk = dialogDefinition.onOk;
                                              dialogDefinition.onOk = function (e) {
                                                  var width = this.getContentElement('info', 'txtWidth');
                                                  width.setValue('100%');
                                                  var height = this.getContentElement('info', 'txtHeight');
                                                  height.setValue('400');
                                                  onOk && onOk.apply(this, e);
                                              };
                                          }
                                      });
                                    </script>
                                <button class="btn btn-primary" data-comment_id="{{$comment->id}}" data-blog_id="{{$blog->id}}" onclick="updateComment(this);">Update</button>
                                <button type="button" class="btn btn-default" id="{{$comment->id}}" onclick="cancleComment(this);">Cancle</button>
                              </div>
                          </div>
                          <div class="comment-meta reply-1">
                            <span id="cmt_like_{{$comment->id}}" >
                              @if( isset($commentLikesCount[$comment->id]) && is_object($currentUser) && isset($commentLikesCount[$comment->id]['user_id'][$currentUser->id]))
                                   <i id="comment_like_{{$comment->id}}" data-blog_id="{{$comment->blog_id}}" data-comment_id="{{$comment->id}}" data-dislike='1' class="fa fa-thumbs-up" aria-hidden="true" data-placement="bottom" title="remove like"></i>
                                   <span id="like1-bs3">{{count($commentLikesCount[$comment->id]['like_id'])}}</span>
                              @else
                                   <i id="comment_like_{{$comment->id}}" data-blog_id="{{$comment->blog_id}}" data-comment_id="{{$comment->id}}" data-dislike='0' class="fa fa-thumbs-o-up" aria-hidden="true" data-placement="bottom" title="add like"></i>
                                   <span id="like1-bs3">@if( isset($commentLikesCount[$comment->id])) {{count($commentLikesCount[$comment->id]['like_id'])}} @endif</span>
                              @endif
                            </span>
                           <span class="mrgn_5_left">
                            @if(is_object($currentUser))
                              <a class="" role="button" data-toggle="collapse" href="#replyToComment{{$blog->id}}-{{$comment->id}}" aria-expanded="false" aria-controls="collapseExample">reply</a>
                            @else
                              <a class="" role="button" data-toggle="modal" data-placement="bottom" href="#loginUserModel">reply</a>
                            @endif
                          </span>
                          <span class="text-muted time-of-reply"><i class="fa fa-clock-o"></i> {{$comment->updated_at->diffForHumans()}}</span>
                          <div class="collapse replyComment" id="replyToComment{{$blog->id}}-{{$comment->id}}">
                              <div class="form-group">
                                <label for="subcomment">Your Sub Comment</label>
                                  <textarea name="comment" id="subcomment_{{$blog->id}}_{{$comment->id}}" class="form-control" rows="3"></textarea>
                              </div>
                              <button class="btn btn-default" onclick="confirmSubmitReplytoComment(this);" data-comment_id="{{$comment->id}}" data-blog_id="{{$blog->id}}">Send</button>
                              <button class="btn btn-default" data-id="replyToComment{{$blog->id}}-{{$comment->id}}" onclick="cancleReply(this);">Cancle</button>
                          </div>
                        </div>
                      </div>
                      @if(count( $comment->children ) > 0)
                        @include('blog.child_comments', ['comments' => $comment->children, 'parent' => $comment->id, 'currentUser' => $currentUser])
                      @endif
                    </div>
                    @endforeach
                  @endif
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="loginUserModel" class="modal fade " role="dialog">
      <div class="modal-dialog modal-sm">
        <div class="modal-content">
          <div class="modal-header"  style="border-bottom: none;">
            <button class="close" data-dismiss="modal">×</button>
          </div>
          <div class="modal-body">
            <div class="modal-data">
                <div class="form-group">
                  <input id="email" name="email" type="email" class="form-control" placeholder="vchip@gmail.com" autocomplete="off" required>
                  <span class="help-block"></span>
                </div>
                <div class="form-group">
                  <input id="password" name="password" type="password" class="form-control" placeholder="password" data-type="password" autocomplete="off" required >
                  <span class="help-block"></span>
                </div>
                <div id="loginErrorMsg" class="hide">Wrong username or password</div>
                <button type="submit" value="login" name="submit" class="btn btn-info btn-block" onClick="loginUser();">Login</button>
                <br />
                <div class="form-group">
                  <a href="{{ url('/auth/facebook') }}" class="btn btn-facebook btn-info" style="width: 209px; background-color: #3B5998; border-color: #3B5998;"><i class="fa fa-facebook"></i> Login </a>
                </div>
                <div class="form-group">
                  <a href="{{ url('/auth/google') }}" class="btn btn-google btn-info" style="width: 209px; background-color: #DD4B39; border-color: #DD4B39;"><i class="fa fa-google"></i> Login </a>
                </div>
                <div class="form-group">
                  <div class="col-md-12 control">
                      <div style="margin-top: 10px; margin-bottom: 20px;  color:#fff;" >
                          Need an account?
                      <a href="{{ url('signup')}}" ">Sign Up</a>
                      </div>
                  </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
</section>
  <footer class="blog-footer ">
    <p>Designed  by <a href="http://vchiptech.com/">Vchip Technology</a>.</p>
    <p>
      <a href="#">Back to top</a>
    </p>
  </footer>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script type="text/javascript" src="{{ asset('js/togleForFilterBy.js') }}"></script>
  <script type="text/javascript">
  function confirmSubmit(ele){
    var userId = parseInt(document.getElementById('user_id').value);
    var blogId = parseInt(document.getElementById('blog_id').value);
    var comment = CKEDITOR.instances.comment.getData();
    document.getElementById('replyToBlog'+blogId).classList.remove("in");
    CKEDITOR.instances.comment.setData('');
    if(0 < userId && comment){
       $.ajax({
            method: "POST",
            url: "{{url('createBlogComment')}}",
            data: {blog_id:blogId, comment:comment}
        })
        .done(function( msg ) {
          renderComments(msg, userId);
        });
    } else if( isNaN(userId)) {
      $('#loginUserModel').modal();
    }
  }
  function cancleReply(ele){
    var id = $(ele).data('id');
    document.getElementById(id).classList.remove("in");
  }

  function updateComment(ele){
    var userId = parseInt(document.getElementById('user_id').value);
    var commentId = $(ele).data('comment_id');
    var blogId = $(ele).data('blog_id');
    commentid = 'comment_'+commentId;
    var comment = CKEDITOR.instances[commentid].getData();
    if(comment){
      $.ajax({
          method: "POST",
          url: "{{url('updateBlogComment')}}",
          data: {blog_id:blogId, comment_id:commentId, comment:comment}
      })
      .done(function( msg ) {
        renderComments(msg, userId);
      });
    }
  }

  function renderComments(msg, userId){
    var allCommentsDiv = document.getElementById('showAllComments');
    allCommentsDiv.innerHTML = '';
    var commentLikesCount = msg['commentLikesCount'];
    var subcommentLikesCount = msg['subcommentLikesCount'];
    arrayComments = [];
    $.each(msg['comments'], function(idx, obj) {
      arrayComments[idx] = obj;
    });
    var sortedArray = arrayComments.reverse();
    $.each(sortedArray, function(idx, obj) {
      if(false == $.isEmptyObject(obj)){
        var chatDiv = document.createElement('div');
        chatDiv.className = 'box-body chat';
        chatDiv.id = 'chat-box';

        var mainCommentDiv = document.createElement('div');
        mainCommentDiv.className = 'item';
        mainCommentDiv.id = 'showComment_'+obj.id;

        var commentImage = document.createElement('img');
        if('system' == obj.image_exist){
          var imageUrl =  "{{ asset('') }}"+obj.user_image;
        } else if('other' == obj.image_exist){
          var imageUrl =  obj.user_image;
        } else {
          var imageUrl = "{{ asset('images/user1.png') }}";
        }
        commentImage.setAttribute('src',imageUrl);
        mainCommentDiv.appendChild(commentImage);

        var commentMessageDiv = document.createElement('div');
        commentMessageDiv.className = 'message';
        if( userId == obj.user_id ){
          var commentEditDeleteDiv = document.createElement('div');
          commentEditDeleteDiv.className = 'dropdown pull-right';
          editDeleteInnerHtml = '<button class="btn dropdown-toggle btn-box-tool "  id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true"><i class="fa fa-ellipsis-v" aria-hidden="true"></i></button>';
          editDeleteInnerHtml += '<ul class="dropdown-menu" aria-labelledby="dropdownMenu1">';
          if( userId == obj.user_id ){
            editDeleteInnerHtml += '<li><a id="'+obj.id+'" data-comment_id="'+obj.id+'" data-blog_id="'+obj.blog_id+'" onclick="confirmCommentDelete(this);">Delete</a></li>';
          }
          if( userId == obj.user_id ){
            editDeleteInnerHtml += '<li><a id="'+obj.id+'" onclick="editComment(this);">Edit</a></li>';
          }
          editDeleteInnerHtml += '</ul>';
          commentEditDeleteDiv.innerHTML = editDeleteInnerHtml;
          commentMessageDiv.appendChild(commentEditDeleteDiv);
        }

        var ancUserNameDiv = document.createElement('a');
        ancUserNameDiv.className = 'SubCommentName';
        ancUserNameDiv.innerHTML = obj.user_name + ' ';
        commentMessageDiv.appendChild(ancUserNameDiv);

        var pCommentBodyDiv = document.createElement('p');
        pCommentBodyDiv.className = 'more';
        pCommentBodyDiv.id = 'editCommentHide_'+obj.id;
        pCommentBodyDiv.innerHTML = obj.body; //'{!! '+obj.body+' !!}';
        commentMessageDiv.appendChild(pCommentBodyDiv);

        var divUpdateComment = document.createElement('div');
        divUpdateComment.className = 'form-group hide';
        divUpdateComment.id = 'editCommentShow_'+obj.id;
        divUpdateComment.innerHTML = '<textarea class="form-control" name="comment" id="comment_'+ obj.id +'" rows="3">'+ obj.body+'</textarea><button class="btn btn-primary" data-comment_id="'+ obj.id +'" data-blog_id="'+ obj.blog_id +'" onclick="updateComment(this);">Update</button><button type="button" class="btn btn-default" id="'+ obj.id +'" onclick="cancleComment(this);">Cancle</button>';
        commentMessageDiv.appendChild(divUpdateComment);
        mainCommentDiv.appendChild(commentMessageDiv);
        $( document ).ready(function() {
          CKEDITOR.replace('comment_'+ obj.id);
          CKEDITOR.config.width="100%";
          CKEDITOR.config.height="auto";
          CKEDITOR.on('dialogDefinition', function (ev) {
              var dialogName = ev.data.name,
                  dialogDefinition = ev.data.definition;
              if (dialogName == 'image') {
                  var onOk = dialogDefinition.onOk;
                  dialogDefinition.onOk = function (e) {
                      var width = this.getContentElement('info', 'txtWidth');
                      width.setValue('100%');
                      var height = this.getContentElement('info', 'txtHeight');
                      height.setValue('400');
                      onOk && onOk.apply(this, e);
                  };
              }
          });
        });

        var commentReplyDiv = document.createElement('div');
        commentReplyDiv.className = 'comment-meta reply-1';

        var spanCommenReply = document.createElement('span');
        spanCommenReply.id = 'cmt_like_'+obj.id;
        var spanCommenInnerHtml = '';
        if( commentLikesCount[obj.id] && commentLikesCount[obj.id]['user_id'][userId]){
          spanCommenInnerHtml +='<i id="comment_like_'+obj.id+'" data-blog_id="'+obj.blog_id+'" data-comment_id="'+obj.id+'" data-dislike="1" class="fa fa-thumbs-up" aria-hidden="true" data-placement="bottom" title="remove like"></i>';
          spanCommenInnerHtml +='<span id="like1-bs3">'+ Object.keys(commentLikesCount[obj.id]['like_id']).length +'</span>';
        } else {
          spanCommenInnerHtml +='<i id="comment_like_'+obj.id+'" data-blog_id="'+obj.blog_id+'" data-comment_id="'+obj.id+'" data-dislike="0" class="fa fa-thumbs-o-up" aria-hidden="true" data-placement="bottom" title="add like"></i>';
          if(commentLikesCount[obj.id]){
            spanCommenInnerHtml +='<span id="like1-bs3">'+ Object.keys(commentLikesCount[obj.id]['like_id']).length +'</span>';
          }
        }
        spanCommenReply.innerHTML = spanCommenInnerHtml;
        commentReplyDiv.appendChild(spanCommenReply);

        var spanCommenReplyButton = document.createElement('span');
        spanCommenReplyButton.className = 'mrgn_5_left';
        spanCommenReplyButton.innerHTML = '<a class="" role="button" data-toggle="collapse" href="#replyToComment'+obj.blog_id+'-'+obj.id+'" aria-expanded="false" aria-controls="collapseExample">reply</a>';
        commentReplyDiv.appendChild(spanCommenReplyButton);

        var spanCommenReplyDate = document.createElement('span');
        spanCommenReplyDate.className = 'text-muted time-of-reply';
        spanCommenReplyDate.innerHTML = '<i class="fa fa-clock-o"></i>'+ obj.updated_at;
        commentReplyDiv.appendChild(spanCommenReplyDate);

        var subCommenDiv = document.createElement('div');
        subCommenDiv.className = 'collapse replyComment';
        subCommenDiv.id = 'replyToComment'+obj.blog_id+'-'+obj.id;
        subCommenDiv.innerHTML = '<div class="form-group"><label for="subcomment">Your Sub Comment</label><textarea name="subcomment" class="form-control" rows="3"  id="subcomment_'+obj.blog_id+'_'+obj.id+'" ></textarea></div><button type="button" class="btn btn-default" onclick="confirmSubmitReplytoComment(this);" data-comment_id="'+obj.id+'" data-blog_id="'+obj.blog_id+'" >Send</button><button class="btn btn-default" data-id="replyToComment'+obj.blog_id+'-'+obj.id+'" onclick="cancleReply(this);">Cancle</button>';
        commentReplyDiv.appendChild(subCommenDiv);
        mainCommentDiv.appendChild(commentReplyDiv);
        chatDiv.appendChild(mainCommentDiv);
        allCommentsDiv.appendChild(chatDiv);
        if( obj['subcomments'] ){
          if(false == $.isEmptyObject(obj['subcomments'])){
            var commentUserId = obj.user_id;
            showSubComments(obj['subcomments'], chatDiv, subcommentLikesCount, userId, commentUserId, allCommentsDiv);
          }
        }
      }
    });
    showMore();
  }

  function showSubComments(subcomments, commentchatDiv, subcommentLikesCount, userId, commentUserId, allCommentsDiv){
    if(false == $.isEmptyObject(subcomments)){
      $.each(subcomments, function(idx, obj) {
        var mainSubCommentDiv = document.createElement('div');
        mainSubCommentDiv.className = 'item replySubComment-1';

        var subcommentImage = document.createElement('img');
        if('system' == obj.image_exist){
          var subcommentImageUrl =  "{{ asset('') }}"+obj.user_image;
        } else if('other' == obj.image_exist){
          var subcommentImageUrl =  obj.user_image;
        } else {
          var subcommentImageUrl = "{{ asset('images/user1.png') }}";
        }
        subcommentImage.setAttribute('src',subcommentImageUrl);
        mainSubCommentDiv.appendChild(subcommentImage);

        var subCommentMessageDiv = document.createElement('div');
        subCommentMessageDiv.className = 'message';
        subCommentMessageDiv.id = 'subcomment_'+obj.id;
        if( userId == obj.user_id || userId == commentUserId){
          var subcommentEditDeleteDiv = document.createElement('div');
          subcommentEditDeleteDiv.className = 'dropdown pull-right';
          editDeleteInnerHtml = '<button class="btn dropdown-toggle btn-box-tool "  id="dropdownMenu2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true"><i class="fa fa-ellipsis-v" aria-hidden="true"></i></button>';
          editDeleteInnerHtml += '<ul class="dropdown-menu" aria-labelledby="dropdownMenu2">';
          if(  userId == obj.user_id || userId == commentUserId){
            editDeleteInnerHtml += '<li><a id="'+obj.blog_comment_id+'_'+obj.id+'" onclick="confirmSubCommentDelete(this);"  data-subcomment_id="'+obj.id+'" data-comment_id="'+obj.blog_comment_id+'" data-blog_id="'+obj.blog_id+'">Delete</a></li>';
          }
          if( userId == obj.user_id ){
            editDeleteInnerHtml += '<li><a id="'+obj.id+'" onclick="editSubComment(this);">Edit</a></li>';
          }
          editDeleteInnerHtml += '</ul>';
          subcommentEditDeleteDiv.innerHTML = editDeleteInnerHtml;
          subCommentMessageDiv.appendChild(subcommentEditDeleteDiv);
        }

        var pSubcommentBodyDiv = document.createElement('p');
        var ancUserNameDiv = document.createElement('a');
        ancUserNameDiv.className = 'SubCommentName';
        ancUserNameDiv.innerHTML = obj.user_name + ' ';
        pSubcommentBodyDiv.appendChild(ancUserNameDiv);

        var spanSubCommentBodyDiv = document.createElement('span');
        spanSubCommentBodyDiv.className = 'more';
        spanSubCommentBodyDiv.id = 'editSubCommentHide_'+obj.id;
        spanSubCommentBodyDiv.innerHTML = obj.body; //'{!! '+obj.body+' !!}';
        pSubcommentBodyDiv.appendChild(spanSubCommentBodyDiv);
        subCommentMessageDiv.appendChild(pSubcommentBodyDiv);

        var divUpdateSubComment = document.createElement('div');
        divUpdateSubComment.className = 'form-group hide';
        divUpdateSubComment.id = 'editSubCommentShow_'+obj.id;

        divUpdateSubComment.innerHTML = '<textarea class="form-control" name="comment" id="updateSubComment_'+ obj.id +'" rows="3">'+ obj.body+'</textarea><button class="btn btn-primary"  data-subcomment_id="'+ obj.id +'" data-comment_id="'+ obj.blog_comment_id +'" data-blog_id="'+ obj.blog_id +'" onclick="updateSubComment(this);">Update</button><button type="button" class="btn btn-default" id="'+ obj.id +'" onclick="cancleSubComment(this);">Cancle</button></div></form>';
        subCommentMessageDiv.appendChild(divUpdateSubComment);
        mainSubCommentDiv.appendChild(subCommentMessageDiv);

        var subcommentReplyDiv = document.createElement('div');
        subcommentReplyDiv.className = 'comment-meta reply-1';

        var spanCommenReply = document.createElement('span');
        spanCommenReply.id = 'sub_cmt_like_'+obj.id;
        var spanSubCommenInnerHtml = '';
        if( subcommentLikesCount[obj.id] && subcommentLikesCount[obj.id]['user_id'][userId]){
          spanSubCommenInnerHtml +='<i id="sub_comment_like_'+obj.id+'" data-blog_id="'+obj.blog_id+'" data-comment_id="'+obj.blog_comment_id+'"  data-sub_comment_id="'+obj.id+'" data-dislike="1" class="fa fa-thumbs-up" aria-hidden="true" data-placement="bottom" title="remove like"></i>';
          spanSubCommenInnerHtml +='<span id="like1-bs3">'+ Object.keys(subcommentLikesCount[obj.id]['like_id']).length +'</span>';
        } else {
          spanSubCommenInnerHtml +='<i id="sub_comment_like_'+obj.id+'" data-blog_id="'+obj.blog_id+'" data-comment_id="'+obj.blog_comment_id+'" data-sub_comment_id="'+obj.id+'" data-dislike="0" class="fa fa-thumbs-o-up" aria-hidden="true" data-placement="bottom" title="add like"></i>';
          if(subcommentLikesCount[obj.id]){
            spanSubCommenInnerHtml +='<span id="like1-bs3">'+ Object.keys(subcommentLikesCount[obj.id]['like_id']).length +'</span>';
          }
        }
        spanCommenReply.innerHTML = spanSubCommenInnerHtml;
        subcommentReplyDiv.appendChild(spanCommenReply);

        var spanSubCommenReplyButton = document.createElement('span');
        spanSubCommenReplyButton.className = 'mrgn_5_left';
        spanSubCommenReplyButton.innerHTML = '<a class="" role="button" data-toggle="collapse" href="#replySubComment'+obj.blog_comment_id+'-'+obj.id+'" aria-expanded="false" aria-controls="collapseExample">reply</a>';
        subcommentReplyDiv.appendChild(spanSubCommenReplyButton);

        var spanSubCommenReplyDate = document.createElement('span');
        spanSubCommenReplyDate.className = 'text-muted time-of-reply';
        spanSubCommenReplyDate.innerHTML = '<i class="fa fa-clock-o"></i>'+ obj.updated_at;
        subcommentReplyDiv.appendChild(spanSubCommenReplyDate);

        var createSubCommenDiv = document.createElement('div');
        createSubCommenDiv.className = 'collapse replyComment';
        createSubCommenDiv.id = 'replySubComment'+obj.blog_comment_id+'-'+obj.id;
        createSubCommenDivInnerHTML = '<div class="form-group"><label for="subcomment">Your Sub Comment</label>';
        if( userId != obj.user_id ){
          createSubCommenDivInnerHTML += '<textarea name="subcomment" class="form-control" rows="3" id="createSubComment_'+ obj.id +'" >'+obj.user_name+'</textarea>';
        } else {
          createSubCommenDivInnerHTML += '<textarea name="subcomment" class="form-control" rows="3" id="createSubComment_'+ obj.id +'"></textarea>';
        }
        createSubCommenDivInnerHTML += '</div><button class="btn btn-default" onclick="confirmSubmitReplytoSubComment(this);" data-subcomment_id="'+ obj.id +'" data-comment_id="'+ obj.blog_comment_id +'" data-blog_id="'+ obj.blog_id +'" >Send</button><button class="btn btn-default" data-id="replySubComment'+ obj.blog_comment_id +'-'+ obj.id +'" onclick="cancleReply(this);">Cancle</button>';
        createSubCommenDiv.innerHTML = createSubCommenDivInnerHTML;
        subcommentReplyDiv.appendChild(createSubCommenDiv);
        mainSubCommentDiv.appendChild(subcommentReplyDiv);
        commentchatDiv.appendChild(mainSubCommentDiv);
        allCommentsDiv.appendChild(commentchatDiv);
      });
    }
  }
   $(document).on("click", "i[id^=comment_like_]", function(e) {
      var blogId = $(this).data('blog_id');
      var commentId = $(this).data('comment_id');
      var dislike = $(this).data('dislike');
      var userId = parseInt(document.getElementById('user_id').value);
      if( isNaN(userId)) {
        $('#loginUserModel').modal();
      } else {
        $.ajax({
            method: "POST",
            url: "{{ url('likeBlogComment') }}",
            data: {blog_id:blogId, comment_id:commentId, dis_like:dislike}
        })
        .done(function( msg ) {
          if( 'false' != msg ){
            var likeSpan = document.getElementById('cmt_like_'+commentId);
              likeSpan.innerHTML = '';
              if( 1 == dislike ){
                likeSpan.innerHTML +='<i id="comment_like_'+commentId+'" data-blog_id="'+blogId+'" data-comment_id="'+commentId+'" data-dislike="0" class="fa fa-thumbs-o-up" aria-hidden="true" data-placement="bottom" title="add like"></i>';
                likeSpan.innerHTML +='<span id="like1-bs3">'+ msg.length +'</span>';
              } else {
                likeSpan.innerHTML +='<i id="comment_like_'+commentId+'" data-blog_id="'+blogId+'" data-comment_id="'+commentId+'" data-dislike="1" class="fa fa-thumbs-up" aria-hidden="true" data-placement="bottom" title="remove like"></i>';
                likeSpan.innerHTML +='<span id="like1-bs3">'+ msg.length +'</span>';
              }
          }
        });
      }
    });

   $(document).on("click", "i[id^=sub_comment_like_]", function(e) {
      var blogId = $(this).data('blog_id');
      var commentId = $(this).data('comment_id');
      var subCommentId = $(this).data('sub_comment_id');
      var dislike = $(this).data('dislike');
      var userId = parseInt(document.getElementById('user_id').value);
      if( isNaN(userId)) {
        $('#loginUserModel').modal();
      } else {
        $.ajax({
            method: "POST",
            url: "{{url('likeBlogSubComment')}}",
            data: {blog_id:blogId, comment_id:commentId, sub_comment_id:subCommentId, dis_like:dislike}
        })
        .done(function( msg ) {
          if( 'false' != msg ){
              var likeSpan = document.getElementById('sub_cmt_like_'+subCommentId);
              likeSpan.innerHTML = '';
              if( 1 == dislike ){
                likeSpan.innerHTML +='<i id="sub_comment_like_'+subCommentId+'" data-blog_id="'+blogId+'" data-comment_id="'+commentId+'" data-sub_comment_id="'+subCommentId+'"  data-dislike="0" class="fa fa-thumbs-o-up" aria-hidden="true" data-placement="bottom" title="add like"></i>';
                likeSpan.innerHTML +='<span id="like1-bs3">'+ msg.length +'</span>';
              } else {
                likeSpan.innerHTML +='<i id="sub_comment_like_'+subCommentId+'" data-blog_id="'+blogId+'" data-comment_id="'+commentId+'" data-sub_comment_id="'+subCommentId+'"  data-dislike="1" class="fa fa-thumbs-up" aria-hidden="true" data-placement="bottom" title="remove like"></i>';
                likeSpan.innerHTML +='<span id="like1-bs3">'+ msg.length +'</span>';
              }
        }
        });
      }
    });
   $(document).on("click", "i[id^=blog_like_]", function(e) {
      var blogId = $(this).data('blog_id');
      var dislike = $(this).data('dislike');
      var userId = parseInt(document.getElementById('user_id').value);
      if( isNaN(userId)) {
        $('#loginUserModel').modal();
      } else {
        $.ajax({
            method: "POST",
            url: "{{url('likeBlog')}}",
            data: {blog_id:blogId, dis_like:dislike}
        })
        .done(function( msg ) {
          if( 'false' != msg ){
            var likeSpan = document.getElementById('like_'+blogId);
            likeSpan.innerHTML = '';
            if( 1 == dislike ){
              likeSpan.innerHTML +='<i id="blog_like_'+blogId+'" data-blog_id="'+blogId+'" data-dislike="0" class="fa fa-thumbs-o-up" aria-hidden="true" data-placement="bottom" title="add like"> Like </i>';
              likeSpan.innerHTML +='<span id="like1-bs3">'+ msg.length +'</span>';
            } else {
              likeSpan.innerHTML +='<i id="blog_like_'+blogId+'" data-blog_id="'+blogId+'" data-dislike="1" class="fa fa-thumbs-up" aria-hidden="true" data-placement="bottom" title="remove like"> Like </i>';
              likeSpan.innerHTML +='<span id="like1-bs3">'+ msg.length +'</span>';
            }
          }
        });
      }
    });

    function editComment(ele){
      var id = $(ele).attr('id');
      document.getElementById('editCommentHide_'+id).classList.add("hide");
      document.getElementById('editCommentShow_'+id).classList.remove("hide");
    }

    function confirmCommentDelete(ele){
        $.confirm({
        title: 'Confirmation',
        content: 'If you delete this comment, all sub comments of this comment will be deleted.',
        type: 'red',
        typeAnimated: true,
        buttons: {
              Ok: {
                  text: 'Ok',
                  btnClass: 'btn-red',
                  action: function(){
                    var userId = parseInt(document.getElementById('user_id').value);
                    var id = $(ele).attr('id');
                    var blogId = $(ele).data('blog_id');
                     $.ajax({
                        method: "POST",
                        url: "{{url('deleteBlogComment')}}",
                        data: {blog_id:blogId, comment_id:id}
                    })
                    .done(function( msg ) {
                      renderComments(msg, userId);
                    });
                  }
              },
              Cancle: function () {
              }
          }
        });
    }
    function confirmSubmitReplytoComment(ele){
      var userId = parseInt(document.getElementById('user_id').value);
      if(0 < userId){
        var commentId = $(ele).data('comment_id');
        var blogId = $(ele).data('blog_id');
        commentid = 'subcomment_'+blogId+'_'+commentId;
        var comment = document.getElementById(commentid).value;
        if(comment){
          $.ajax({
              method: "POST",
              url: "{{url('createBlogSubComment')}}",
              data: {blog_id:blogId, comment_id:commentId, comment:comment}
          })
          .done(function( msg ) {
            renderComments(msg, userId);
          });
        }
      } else if( isNaN(userId)) {
        $('#loginUserModel').modal();
      }
    }

    function confirmSubmitReplytoSubComment(ele){
      var userId = parseInt(document.getElementById('user_id').value);
      if(0 < userId){
        var commentId = $(ele).data('comment_id');
        var blogId = $(ele).data('blog_id');
        var subcommentId = $(ele).data('subcomment_id');
        subcommentid = 'createSubComment_'+subcommentId;
        var comment = document.getElementById(subcommentid).value;
        if(comment){
          $.ajax({
              method: "POST",
              url: "{{url('createBlogSubComment')}}",
              data: {blog_id:blogId, comment_id:commentId, subcomment_id:subcommentId, comment:comment}
          })
          .done(function( msg ) {
            renderComments(msg, userId);
          });
        }
      } else if( isNaN(userId)) {
        $('#loginUserModel').modal();
      }
    }

    function editSubComment(ele){
      var id = $(ele).attr('id');
      document.getElementById('editSubCommentHide_'+id).classList.add("hide");
      document.getElementById('editSubCommentShow_'+id).classList.remove("hide");
    }

    function confirmSubCommentDelete(ele){
      $.confirm({
        title: 'Confirmation',
        content: 'You want to delete this comment?',
        type: 'red',
        typeAnimated: true,
        buttons: {
              Ok: {
                  text: 'Ok',
                  btnClass: 'btn-red',
                  action: function(){
                    var userId = parseInt(document.getElementById('user_id').value);
                    var commentId = $(ele).data('comment_id');
                    var subcommentId = $(ele).data('subcomment_id');
                    var blogId = $(ele).data('blog_id');
                      $.ajax({
                          method: "POST",
                          url: "{{url('deleteBlogSubComment')}}",
                          data: {blog_id:blogId, comment_id:commentId, subcomment_id:subcommentId}
                      })
                      .done(function( msg ) {
                        renderComments(msg, userId);
                      });
                  }
              },
              Cancle: function () {
              }
          }
        });
    }

    function updateSubComment(ele){
      var commentId = $(ele).data('comment_id');
      var blogId = $(ele).data('blog_id');
      var subcommentId = $(ele).data('subcomment_id');
      var comment = document.getElementById('updateSubComment_'+subcommentId).value;
      var userId = parseInt(document.getElementById('user_id').value);
      $.ajax({
          method: "POST",
          url: "{{url('updateBlogSubComment')}}",
          data: {blog_id:blogId, comment_id:commentId, subcomment_id:subcommentId, comment:comment}
      })
      .done(function( msg ) {
        renderComments(msg, userId);
      });
  }

    function showMore(){
      var showChar = 400;
      var ellipsestext = "...";
      var moretext = "Read more";
      var lesstext = "less";
      $('.more').each(function() {
        var content = $(this).html();

        if(content.length > showChar) {

          var c = content.substr(0, showChar);
          var h = content.substr(0, content.length);
          var html = '<div class="zxc">'+ c + '<span style="color:#01bafd; margin-left:5px;">' + ellipsestext+ '</span><br /><a href="" class="morelink" style="color:#01bafd";>' + moretext + '</a></div><div class="zxc1" style="display:none;">'+ h + '<br /><a href="" class="morelink1" style="color:#01bafd";>' + lesstext + '</a></div>';

          $(this).html(html);
        }

      });

      $(".morelink").click(function(){
        $(this).closest('.zxc').toggle();
        $(this).closest('.zxc').siblings('.zxc1').toggle();
        return false;
      });
      $(".morelink1").click(function(){
        $(this).closest('.zxc1').toggle();
        $(this).closest('.zxc1').siblings('.zxc').toggle();
        return false;
      });
    }

    $( document ).ready(function() {
      showCommentEle = "{{ Session::get('blog_comment_area')}}";
      showSubCommentEle = "{{ Session::get('show_subcomment_area')}}";
      if(showCommentEle > 0){
        window.location.hash = '#showComment_'+showCommentEle;
      } else if(showSubCommentEle > 0){
        window.location.hash = '#subcomment_'+showSubCommentEle;
      }
      showMore();
    });

  function loginUser(){
    var email = document.getElementById('email').value;
    var password = document.getElementById('password').value;
    if(email && password){
      $.ajax({
          method: "POST",
          url: "{{ url('userLogin') }}",
          data: {email:email, password:password}
      })
      .done(function( msg ) {
        if('true' == msg){
          window.location.reload(true);
        } else {
          document.getElementById('loginErrorMsg').classList.remove('hide');
        }
      });
    }
  }

  $(window).on('load', function(e){
    if (window.location.hash == '#_=_') {
      window.location.hash = ''; // for older browsers, leaves a # behind
      history.pushState('', document.title, window.location.pathname); // nice and clean
      e.preventDefault(); // no page reload
    }
  });
  </script>
</body>
</html>